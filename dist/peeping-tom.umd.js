!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).peepingTom=t()}(this,(function(){"use strict";var e={dataset:"peeping-tom",root:document.body,visible:.8},t=new Map,n={intr:void 0,mutn:void 0},r={},o=new WeakSet,i=e.dataset,a=i.replace(/-(\w)/g,(function(e,t){return t.toUpperCase()})),c=function(){var e={promise:null,resolve:null,reject:null};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e},s=function(e){return e&&e.nodeType===Node.ELEMENT_NODE},u=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},d=function(e,t){return(t.keys?Array.from(t.keys()):Object.keys(t)).find((function(t){return new RegExp(t).test(e)}))},f=function(e){return!(!e||"string"!=typeof e||!e.length)},l=function(e){return f(e)||Array.isArray(e)&&!e.some((function(e){return!f(e)}))},v=function(e){return s(e)&&e.dataset&&e.dataset[a]?e.dataset[a]:null},p=function(e,t,n){var o=r[e];if(o&&o.data&&u(o.fn)){var i=function(e){u(e)?o.fn(e(t,n)):o.fn(e)};o.data.promise?o.data.promise.then((function(e){i(e)})).catch((function(){o.data=c()})):i(o.data)}},b=function(e){var t=n.intr,i=v(e.target);if(i){var a=d(i,r)||i;r[a]&&r[a].events.includes(e.type)&&(o.has(e.target)&&t?(t.unobserve(e.target),o.delete(e.target),p(a,[e.type,"view"],e.target)):p(a,e.type,e.target))}},y=function(e,n){e.forEach((function(e){var r=v(e.target);if(r&&e.isIntersecting){var i=d(r,t)||r,a=t.get(i);if(!(a&&e.intersectionRatio>=a))return;n.unobserve(e.target),o.delete(e.target),p(i,"view",e.target)}}))},g=function(e){var r=n.intr;e.forEach((function(e){var n=v(e);if(n){var i=d(n,t)||n;t.has(i)&&r&&(r.observe(e),o.add(e))}}))},h=function(e){e.forEach((function(e){"childList"===e.type&&e.addedNodes&&e.addedNodes.length&&g(e.addedNodes)}))},m=function(){var r=[e.visible],o=Array.from(t).reduce((function(e,[t,n]){return r.includes(n)||r.push(n),e.concat(function(e){var t={starts:["^",/^\^/],ends:["$",/\$$/]},n=Object.keys(t).find((function(n){return e["".concat(n,"With")](t[n][0])}));return n?"[data-".concat(i).concat(t[n][0],'="').concat(e.replace(t[n][1],""),'"],'):"[data-".concat(i,'="').concat(e,'"],')}(t))}),"");o=o.substring(0,o.length-1),n.intr=new IntersectionObserver(y,{root:null,threshold:r.sort(),delay:100});var a=document.querySelectorAll(o);a&&a.length&&g(a),n.mutn=new MutationObserver(h),n.mutn.observe(e.root,{attributes:!1,characterData:!1,childList:!0,subtree:!0})},O="".concat(String.fromCodePoint(128064),"TypeError: invalid arguments\n\t");function w(){}return{Deferred:w,disconnect:function(){var t=n.intr,r=n.mutn;e.root.removeEventListener("click",b),t&&r&&(r.disconnect(),t.disconnect&&t.disconnect())},resolve:function(e,t){if(f(e)){var n=r[e];if(n&&n.data&&n.data.resolve)return void n.data.resolve(t)}console.error(O,e,t)},watch:function(n,o){n=n||{},o=o||{};var i=function(e,[t,n]){return n&&(e[t]=n),e},a=function({dataset:e,root:t,visible:n}){return Object.entries({dataset:e,root:t,visible:n}).reduce(i,{})},d=function({events:e,visible:t,data:n,fn:r}){return{events:e,visible:t,data:n,fn:r}},v=function(e){return!!(null!=e&&"number"==typeof e&&(e-0)*(1-e)>=0)},p={events:l,fn:u};Object.entries(n).forEach((function([n,o]){var i=d(o);if(Object.entries(p).every((function([e,t]){return i[e]&&t(i[e])}))){if(i.data&&i.data instanceof w&&(i.data=c()),r[n]=i,i.events.includes("view")){var a=Object.prototype.hasOwnProperty.call(i,"visible")&&v(i.visible)?Math.abs(i.visible):e.visible;t.set(n,a)}}else console.error(O,n,o)})),Object.assign(e,a(o)),Object.entries({dataset:f,root:s,visible:v}).some((function([e,t]){return!(!Object.prototype.hasOwnProperty.call(o,e)||t(o[e]))}))?console.error(O,o):(t.size&&m(),e.root.addEventListener("click",b))}}}));
